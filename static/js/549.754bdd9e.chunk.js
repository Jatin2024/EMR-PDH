"use strict";(self.webpackChunkerp_product_hub=self.webpackChunkerp_product_hub||[]).push([[549],{549:(e,t,o)=>{o.r(t),o.d(t,{default:()=>w});var n=o(43),r=o(391),a=o(579);const i=e=>{let{onDropSuccess:t}=e;const o=(0,n.useRef)(null);return(0,n.useEffect)((()=>{const e=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},n=e=>{e.preventDefault();const o=e.dataTransfer.getData("text/plain");try{const e=JSON.parse(o);console.log("Dropped object:",e),t&&t(e)}catch(n){console.warn("Invalid drop data",n)}},r=o.current;return r&&(r.addEventListener("dragover",e),r.addEventListener("drop",n)),()=>{r&&(r.removeEventListener("dragover",e),r.removeEventListener("drop",n))}}),[t]),(0,a.jsxs)("div",{ref:o,className:"droppable-container mt-4",children:[(0,a.jsx)("img",{style:{width:"90px",height:"90px"},src:"https://thewhitechamaleon.github.io/testrapp/images/drag.png",alt:"Data Collect",className:"search-icon"}),(0,a.jsx)("span",{className:"drag-and-drop-text",children:"Drag and Drop your object here"})]})},s=async()=>await new Promise(((e,t)=>{window.require(["DS/WAFData/WAFData"],(t=>{e(t)}),t)})),d=async e=>{try{const t=await(async()=>{try{let e="VPLMAdmin.Company Name.Default";const t=await s();console.log("Security Context is:",e);const o="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF?tenant=OI000186152",n=await new Promise(((e,n)=>{t.authenticatedRequest(o,{method:"GET",type:"json",onComplete:e,onFailure:n})})),r=n.csrf.name,a=n.csrf.value,i="SecurityContext",d=e;return{[r]:a,[i]:d}}catch(e){return void console.error("[CSRF] Failed to fetch token:",e)}})();if(!t)throw new Error("Missing CSRF headers");const o=`https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/${e}?$fields=flowDown`,n=await s();return await new Promise(((e,r)=>{n.authenticatedRequest(o,{method:"GET",headers:{...t,"Content-Type":"application/json"},type:"json",onComplete:e,onFailure:r})}))}catch(t){throw console.error("[Change Action] Failed to fetch flowDown:",t),t}},l=()=>{const[e,t]=(0,n.useState)(""),[o,r]=(0,n.useState)("");(0,n.useEffect)((()=>{window.resetToDropArea=()=>{console.log("[App] Resetting to Drop Area View"),t(""),r("")};const e=e=>{var t,o,n,r;const a=null===(t=e.target)||void 0===t||null===(o=t.closest)||void 0===o?void 0:o.call(t,".refresh, .wux-menuItem-label");a&&null!==(n=a.innerText)&&void 0!==n&&null!==(r=n.toLowerCase)&&void 0!==r&&r.call(n).includes("refresh")&&(console.log("[App] \ud83d\uddb1 Manual refresh clicked"),window._lastRefreshWasManual=!0)};return window.addEventListener("click",e),window.widget&&"function"===typeof window.widget.addEvent&&window.widget.addEvent("onRefresh",(()=>{const e=!!window._lastRefreshWasManual;console.log(`[App] \ud83d\udd04 onRefresh triggered | Manual: ${e}`),"function"===typeof window.resetToDropArea&&window.resetToDropArea(),window._lastRefreshWasManual=!1})),()=>{window.removeEventListener("click",e)}}),[]);return o?(0,a.jsx)("div",{className:"error",children:o}):(0,a.jsx)("div",{children:e?(0,a.jsx)("iframe",{src:e,title:"CA Details",style:{width:"100vw",height:"100vh",border:"none"}}):(0,a.jsx)(i,{onDropSuccess:async e=>{try{var o,n;const r=null===e||void 0===e||null===(o=e.data)||void 0===o||null===(n=o.items)||void 0===n?void 0:n[0];if(!r)throw new Error("Dropped item is missing");const{objectType:a,objectId:i}=r;if("Change Action"!==a)return void alert("This functionality is not available for selected type");const s=await d(i),l=null===s||void 0===s?void 0:s.isFlowDownOf;if(l&&l.length>0){const e=l[0].identifier;t(`https://emr-product-datahub-qa.azurewebsites.net/caDetails/${e}`)}else{t(`https://plmpdh-qa.emerson.com/caDetails/${i}`)}}catch(a){console.error("Drop handler failed:",a),r(a.message||"Unknown error")}}})})};let c=null;function w(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let o=(null===(e=window.widget)||void 0===e||null===(t=e.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");o||(o=document.createElement("div"),o.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(o):document.body.appendChild(o)),c||(c=r.createRoot(o)),c.render((0,a.jsx)(l,{}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}}}]);
//# sourceMappingURL=549.754bdd9e.chunk.js.map