"use strict";(self.webpackChunkerp_product_hub=self.webpackChunkerp_product_hub||[]).push([[549],{549:(e,o,t)=>{t.r(o),t.d(o,{default:()=>l});var n=t(43),r=t(391),s=t(579);const a=e=>{let{onDropSuccess:o}=e;const t=(0,n.useRef)(null);return(0,n.useEffect)((()=>{const e=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},n=e=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain");try{const e=JSON.parse(t);console.log("Dropped object:",e),o&&o(e)}catch(n){console.warn("Invalid drop data",n)}},r=t.current;return r&&(r.addEventListener("dragover",e),r.addEventListener("drop",n)),()=>{r&&(r.removeEventListener("dragover",e),r.removeEventListener("drop",n))}}),[o]),(0,s.jsxs)("div",{ref:t,className:"droppable-container mt-4",children:[(0,s.jsx)("img",{style:{width:"90px",height:"90px"},src:"https://thewhitechamaleon.github.io/testrapp/images/drag.png",alt:"Data Collect",className:"search-icon"}),(0,s.jsx)("span",{className:"drag-and-drop-text",children:"Drag and Drop your object here"})]})},i=async e=>{try{const o=await(async()=>{try{const e="VPLMAdmin.Company Name.Default",o="https://oi000186152-eu1.iam.3dexperience.3ds.com/login?action=get_auth_params",t=await fetch(o);if(!t.ok)throw new Error(`Failed to fetch login token. Status: ${t.status}`);const n=await t.json(),r=null===n||void 0===n?void 0:n.lt;if(!r)return console.warn("[Login] Token missing. Aborting further steps."),null;console.log("[Login] Token:",r);const s="https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/application/CSRF?tenant=OI000186152",a=`https://oi000186152-eu1.iam.3dexperience.3ds.com/login?lt=${r}&username=emrserviceuser&password=Emerson123`;console.log("Final loginUrl:",a);const i=await fetch(a,{method:"POST",credentials:"include"});if(console.log("Login response is:",i),!i.ok)throw new Error(`Login failed. Status: ${i.status}`);const d=await i.json(),c=await fetch(s,{method:"GET"});if(console.log("CSRF RESPONSE: ",c),!d.csrf)return console.error("CSRF token not found in login response:",d),null;const l=d.csrf.name,u=d.csrf.value,p={[l]:u,SecurityContext:e,"Content-Type":"application/json"};return console.log("[CSRF] Token fetched and headers ready:",p),p}catch(e){return console.error("[CSRF] Failed to fetch token:",e),null}})();if(!o)throw new Error("Missing CSRF headers");const t=`https://oi000186152-us1-space.3dexperience.3ds.com/enovia/resources/v1/modeler/dslc/changeaction/${e}?$fields=flowDown`,n=await(async()=>await new Promise(((e,o)=>{window.require(["DS/WAFData/WAFData"],(o=>{e(o)}),o)})))();return await new Promise(((e,r)=>{n.authenticatedRequest(t,{method:"GET",headers:{...o,"Content-Type":"application/json"},type:"json",onComplete:e,onFailure:r})}))}catch(o){throw console.error("[Change Action] Failed to fetch flowDown:",o),o}},d=()=>{const[e,o]=(0,n.useState)(""),[t,r]=(0,n.useState)("");(0,n.useEffect)((()=>{window.resetToDropArea=()=>{console.log("[App] Resetting to Drop Area View"),o(""),r("")};let e=!1;const t=o=>{var t;const n=null===(t=window.parent)||void 0===t?void 0:t.document;if(!n)return;const r=n.querySelector(".widget-menu-icon"),s=o.target.closest(".refresh-item");r&&r.contains(o.target)&&(console.log("[App] Dropdown opened."),e=!1),s&&"Refresh"===s.textContent.trim()&&(console.log("[App] User manually clicked Refresh."),e=!0)};return window.parent.document.body.addEventListener("mousedown",t,!0),window.widget&&"function"===typeof window.widget.addEvent&&window.widget.addEvent("onRefresh",(()=>{console.log(`[App] \ud83d\udd04 onRefresh triggered | Manual: ${e}`),e&&"function"===typeof window.resetToDropArea&&window.resetToDropArea(),e=!1})),()=>{window.parent.document.body.removeEventListener("mousedown",t,!0)}}),[]);return t?(0,s.jsx)("div",{className:"error",children:t}):(0,s.jsx)("div",{children:e?(0,s.jsx)("iframe",{src:e,title:"CA Details",style:{width:"100vw",height:"100vh",border:"none"}}):(0,s.jsx)(a,{onDropSuccess:async e=>{try{var t,n;const r=null===e||void 0===e||null===(t=e.data)||void 0===t||null===(n=t.items)||void 0===n?void 0:n[0];if(!r)throw new Error("Dropped item is missing");const{objectType:s,objectId:a}=r;if("Change Action"!==s)return void alert("This functionality is not available for selected type");const d=await i(a),c=null===d||void 0===d?void 0:d.isFlowDownOf;if(c&&c.length>0){const e=c[0].identifier;o(`https://emr-product-datahub-qa.azurewebsites.net/caDetails/${e}`)}else{o(`https://plmpdh-qa.emerson.com/caDetails/${a}`)}}catch(s){console.error("Drop handler failed:",s),r(s.message||"Unknown error")}}})})};let c=null;function l(){if(window.widget){let e=!1;window.widget.addEvent("onLoad",(()=>{e?console.warn("[index.js] \u23f3 onLoad was already executed. Ignoring duplicate trigger."):(e=!0,function(){var e,o;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));let t=(null===(e=window.widget)||void 0===e||null===(o=e.body)||void 0===o?void 0:o.querySelector("#root"))||document.getElementById("root");t||(t=document.createElement("div"),t.id="root",window.widget&&window.widget.body?window.widget.body.appendChild(t):document.body.appendChild(t)),c||(c=r.createRoot(t)),c.render((0,s.jsx)(d,{}))}())}))}else console.error("[index.js] \u274c Widget not detected! onLoad cannot be registered.")}}}]);
//# sourceMappingURL=549.e837d9c2.chunk.js.map